Analizando todo el repositorio...

**ROADMAP DE MEJORAS - ISO 27001 Platform**

---

## FASE 1: CORRECCIONES CRÍTICAS DE SEGURIDAD Y AUDITORÍA

### 1.1 Sidebar con Control de Permisos
- Ocultar opciones según rol del usuario
- Implementar verificación RoleMiddleware::can() en sidebar
- Marcar enlace activo según ruta actual

### 1.2 Auditoría Completa en Todas las Operaciones
- **UsuarioController**: Agregar logs en create, update, delete
- **RequerimientoController**: Agregar logs en update
- **AuthService**: Ya tiene login/logout (OK)
- **Otros controladores**: Verificar cobertura completa

### 1.3 Validación de Tenant en Todas las Operaciones
- Verificar TenantContext antes de queries críticos
- Agregar validación en repositorios que faltan

---

## FASE 2: FUNCIONALIDAD FALTANTE EN USUARIOS

### 2.1 UsuarioController - Métodos Faltantes
- Agregar método `show()` para ver detalle
- Agregar método `cambiarEstado()` para activar/desactivar
- Corregir método `delete()` para usar softDelete del modelo

### 2.2 Búsqueda y Paginación en Usuarios
- Implementar `searchWithPagination()` en UsuarioRepository
- Agregar ruta `/usuarios/search`
- Actualizar vista index con búsqueda tipo controles
- Agregar paginación con controles de navegación

### 2.3 Vistas de Usuarios Consistentes
- Eliminar Bootstrap de usuarios/show.php
- Eliminar usuarios/edit.php y perfil/edit.php (duplicados)
- Usar HTML básico como el resto del sistema

---

## FASE 3: GESTIÓN DE RESPONSABLES EN CONTROLES

### 3.1 Asignación de Responsables
- Actualizar ControlController::update para incluir campo responsable
- Modificar vista controles/show.php con select de usuarios
- Agregar método en UsuarioRepository::getByRole('admin_empresa', 'auditor')

### 3.2 Vista Mejorada de Controles
- Mostrar evidencias relacionadas en detalle
- Mostrar GAPs activos relacionados
- Mostrar responsable asignado con nombre completo

---

## FASE 4: BÚSQUEDA Y PAGINACIÓN EN MÓDULOS RESTANTES

### 4.1 Auditoría con Paginación
- Implementar paginación en AuditLogRepository
- Actualizar vista audit/index.php con controles de página
- Mantener filtros actuales (usuario, acción, tabla, fechas)

### 4.2 Evidencias con Búsqueda
- Agregar búsqueda por nombre de archivo o control
- Implementar searchWithPagination en EvidenciaRepository
- Actualizar vista evidencias/index.php

### 4.3 GAPs con Búsqueda
- Agregar búsqueda por descripción de brecha
- Implementar searchWithPagination en GapRepository
- Actualizar vista gap/index.php

---

## FASE 5: VALIDACIONES DE NEGOCIO

### 5.1 Validación en Creación de GAPs
- Verificar que control esté en estado 'no_implementado' o 'parcial'
- Verificar que control sea aplicable
- Prevenir GAPs duplicados en mismo control

### 5.2 Validación en Evidencias
- Verificar que control sea aplicable antes de subir evidencia
- Al aprobar evidencia, verificar si TODAS las del control están aprobadas
- Solo entonces actualizar SOA a 'implementado'

### 5.3 Completitud de Requerimientos Optimizada
- Mejorar lógica de verificación (actualmente puede ser lenta)
- Agregar caché para consultas repetitivas
- Solo recalcular cuando cambia estado de control o evidencia

---

## FASE 6: MEJORAS DE UI/UX

### 6.1 Feedback Visual Mejorado
- Agregar spinners de carga en todas las acciones AJAX
- Mejorar mensajes de error con detalles específicos
- Agregar confirmaciones antes de acciones destructivas

### 6.2 Dashboard Mejorado
- Agregar gráficos de progreso por dominio (ya está en views pero falta datos)
- Mostrar actividad reciente real desde audit_logs
- Agregar alertas de GAPs vencidos

### 6.3 Navegación Mejorada
- Breadcrumbs en todas las vistas
- Links contextuales entre módulos relacionados
- Botón "Volver" consistente en todas las vistas

---

## FASE 7: OPTIMIZACIONES DE RENDIMIENTO

### 7.1 Caché en Consultas Frecuentes
- Cachear estadísticas del dashboard (5 minutos)
- Cachear lista de dominios (1 hora)
- Cachear lista de controles base (1 hora)

### 7.2 Índices de Base de Datos
- Verificar índices en tablas audit_logs
- Agregar índice compuesto en (empresa_id, created_at) para auditoría
- Verificar índices en búsquedas de texto

---

## FASE 8: TESTING Y DOCUMENTACIÓN

### 8.1 Testing Manual
- Probar todos los flujos de usuario por rol
- Verificar permisos en cada acción
- Probar multi-tenancy con múltiples empresas

### 8.2 Logs y Monitoreo
- Verificar que todos los errores se loguean
- Probar rate limiting en todas las rutas
- Verificar CSRF en todos los formularios

---

**PRIORIDAD DE EJECUCIÓN:**

1. FASE 1 (Seguridad crítica)
2. FASE 2 (Usuarios completos)
3. FASE 3 (Responsables)
4. FASE 4 (Búsquedas y paginación)
5. FASE 5 (Validaciones)
6. FASE 6 (UI/UX)
7. FASE 7 (Optimización)
8. FASE 8 (Testing)
